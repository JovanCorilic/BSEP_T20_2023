<br>
<div id = "zahtevSertifikat" style="text-align: center;width: 20%;margin-left: 40%;">
    <form [formGroup]="createForm" (ngSubmit)="update()">
        <div [ngClass]="['form-group','block']">
            <p>Datum početka</p>
            <input type="datetime-local" [ngClass]="['form-control','input']" formControlName="startDate">
			<small style="color: red;"
				*ngIf="createForm.controls.startDate.touched && createForm.controls.startDate.errors?.required">
				Neophodan je datum početka</small>
        </div>
        <div [ngClass]="['form-group','block']">
            <p>Datum završetka</p>
            <input type="datetime-local" [ngClass]="['form-control','input']" formControlName="endDate">
			<small style="color: red;"
				*ngIf="createForm.controls.endDate.touched && createForm.controls.endDate.errors?.required">
				Datum završetka je obavezan</small>
        </div>
        <div [ngClass]="['form-group','block']">
            <p>Email Potvrda</p>
            <input type="text" [ngClass]="['form-control','input']" formControlName="emailPotvrda" placeholder="Email Potvrda">
            <small style="color: red;"
                *ngIf="createForm.controls.emailPotvrda.touched && createForm.controls.emailPotvrda.errors?.required">
                Email Potvrda je obavezna</small>
        </div>
        <div [ngClass]="['form-group','block']">
            <p>Organizaciona Jedinica</p>
            <input type="text" [ngClass]="['form-control','input']" formControlName="organizacionaJedinica" placeholder="Katedra Informatike">
            <small style="color: red;"
                *ngIf="createForm.controls.organizacionaJedinica.touched && createForm.controls.organizacionaJedinica.errors?.required">
                Organizaciona Jedinica je obavezna</small>
        </div>
        <div [ngClass]="['form-group','block']">
            <p>Naziv Organizacije</p>
            <input type="text" [ngClass]="['form-control','input']" formControlName="nazivOrganizacije" placeholder="Email Potvrda">
            <small style="color: red;"
                *ngIf="createForm.controls.nazivOrganizacije.touched && createForm.controls.nazivOrganizacije.errors?.required">
                Naziv Organizacije je obavezna</small>
        </div>
        <div [ngClass]="['form-group','block']">
            <p>Skraceni Naziv Zemlje</p>
            <input type="text" [ngClass]="['form-control','input']" formControlName="skraceniNazivZemlje" placeholder="Email Potvrda">
            <small style="color: red;"
                *ngIf="createForm.controls.skraceniNazivZemlje.touched && createForm.controls.skraceniNazivZemlje.errors?.required">
                Skraceni Naziv Zemlje je obavezno</small>
        </div>
        <p>Namena sertifikata</p>
        <div [ngClass]="['form-group','block','select is-rounded']">
            <select formControlName="namena" (change)="pokazivanjeElemenata($event)">
                <option value="Korisnik">Korisnik</option>
                <option value="Moja kuca aplikacija">Moja kuca aplikacija</option>
                <option value="Uredjaj">Uredjaj</option>
                <option value="Za mene">Za mene</option>
            </select>
        </div>
        <div *ngIf="pokazivanje===1">
            <div [ngClass]="['form-group','block']">
                <p>Email</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="email" placeholder="Email">
                <small style="color: red;"
                    *ngIf="createForm.controls.email.touched && createForm.controls.email.errors?.required">
                    Email je obavezan</small>
            </div>
            <div [ngClass]="['form-group','block']">
                <p>Ime</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="ime" placeholder="Ime">
                <small style="color: red;"
                    *ngIf="createForm.controls.ime.touched && createForm.controls.ime.errors?.required">
                    Ime is required</small>
            </div>
            <div [ngClass]="['form-group','block']">
                <p>Prezime</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="prezime" placeholder="Prezime">
                <small style="color: red;"
                    *ngIf="createForm.controls.prezime.touched && createForm.controls.prezime.errors?.required">
                    Prezime is required</small>
            </div>
        </div>
        <div *ngIf="pokazivanje===2">
            <div [ngClass]="['form-group','block']">
                <p>Serijski Broj</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="serijskiBroj" placeholder="Serijski Broj">
                <small style="color: red;"
                    *ngIf="createForm.controls.serijskiBroj.touched && createForm.controls.serijskiBroj.errors?.required">
                    Serijski Broj is required</small>
            </div>
        </div>
        <div *ngIf="pokazivanje===3">
            <div [ngClass]="['form-group','block']">
                <p>Naziv</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="naziv" placeholder="Naziv">
                <small style="color: red;"
                    *ngIf="createForm.controls.naziv.touched && createForm.controls.naziv.errors?.required">
                    naziv is required</small>
            </div>
            <div [ngClass]="['form-group','block']">
                <p>Svrha</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="svrha" placeholder="Svrha">
                <small style="color: red;"
                    *ngIf="createForm.controls.svrha.touched && createForm.controls.svrha.errors?.required">
                    svrha is required</small>
            </div>
            <div [ngClass]="['form-group','block']">
                <p>Serijski Broj</p>
                <input type="text" [ngClass]="['form-control','input']" formControlName="serijskiBroj" placeholder="Serijski Broj">
                <small style="color: red;"
                    *ngIf="createForm.controls.serijskiBroj.touched && createForm.controls.serijskiBroj.errors?.required">
                    Serijski Broj is required</small>
            </div>
        </div><br>
        <div [ngClass]="['form-group','block']">
    		<button *ngIf="getRole()==='ROLE_MUSTERIJA'" type="submit" [ngClass]="['btn btn-primary btn-block',status2 ? 'button is-warning is-outlined' : 'button is-warning is-outlined is-loading']" [disabled]="createForm.invalid">Promeni zahtev</button>
		</div>
    </form><br>
    <div class="block">
        <br>
            <button type="button" class="btn btn-lg btn-outline-primary" 
                        (click)="open(ekstenzije2)">
                        Ekstenzije
            </button><br>
        <button class="button is-outlined" (click)="natrag()">Natrag</button>&nbsp;&nbsp;
        
        <button *ngIf="getRole()==='ROLE_ADMIN'" [ngClass]="[status ? 'button is-danger is-outlined' : 'button is-danger is-outlined is-loading']" (click)="napraviSertifikat()">Napravi sertifikat</button>
    </div>
</div>

<ng-template #ekstenzije2 let-modal>
    <div class="modal-header">
        <h4 class="modal-title" 
            id="modal-basic-title">
            Ekstenzije
        </h4>
        <button type="button" class="close"
                aria-label="Close" (click)=
                "modal.dismiss('Cross click')">
            <span aria-hidden="true">
                ×
            </span>
        </button>
    </div>
    <div class="modal-body">
        
        <div class="form-group">
            <div >
                <div *ngIf="ekstenzije.authorityKeyIdentifierEkstenzije !== null" class="block"><br>
                    <button class="button is-danger">Authority Key Identifier</button>&nbsp;&nbsp;
                    <mat-checkbox [(ngModel)]="ekstenzije.authorityKeyIdentifierEkstenzije.daLiJeKriticno">Da li je kriticno</mat-checkbox><br>
                </div>
                <div *ngIf="ekstenzije.basicConstraintsEkstenzije !== null" class="block">
                    <button class="button is-danger is-outlined" (click)="open(basicConstraintsEkstenzije)">Basic Constraints</button><br>
                </div>
                <div *ngIf="ekstenzije.extendedKeyUsageEkstenzije !== null" class="block">
                    <button class="button is-danger is-outlined" (click)="open(extendedKeyUsageEkstenzije)">Extended Key Usage</button><br>
                </div>
                <div *ngIf="ekstenzije.keyUsageEkstenzije !== null" class="block">
                    <button class="button is-danger is-outlined" (click)="open(keyUsageEkstenzije)">Key Usage</button><br>
                </div>
                <div *ngIf="ekstenzije.subjectAlternativeNameEkstenzije !== null" class="block">
                    <button class="button is-danger is-outlined" (click)="open(subjectAlternativeNameEkstenzije)">Subject Alternative Name</button><br>
                </div>
                <div *ngIf="ekstenzije.subjectKeyIdentifierEkstenzije !== null" class="block">
                    <button class="button is-danger">Subject Key Identifier</button>&nbsp;&nbsp;
                    <mat-checkbox [(ngModel)]="ekstenzije.subjectKeyIdentifierEkstenzije.daLiJeKriticno">Da li je kriticno</mat-checkbox><br>
                </div>
            </div>
        </div>
        
    </div>
    <div class="modal-footer">
        <button type="button" 
            class="btn btn-outline-dark" 
            (click)="modal.close('Save click')">
            Sacuvaj
        </button>
    </div>
</ng-template>

<ng-template #basicConstraintsEkstenzije let-modal>
    <div class="modal-header">
        <h4 class="modal-title" 
            id="modal-basic-title">
            Basic Constraints
        </h4>
        <button type="button" class="close"
                aria-label="Close" (click)=
                "modal.dismiss('Cross click')">
  
            <span aria-hidden="true">
                ×
            </span>
        </button>
    </div>
        <div class="modal-body">
                <div class="form-group">
                    <label for="maxLen">
                        Maksimalna duzina
                    </label>
                    <div class="input-group">
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.basicConstraintsEkstenzije.daLiJeKriticno">Da li je kriticno</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.basicConstraintsEkstenzije.daLiJeCA">Da li je CA</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <p id="maxLen">{{ekstenzije.basicConstraintsEkstenzije.maxPathLen}}</p>
                        </div>
                    </div>
                </div>
        </div>
        <div [ngClass]="['modal-footer','form-group']">

        </div>
   
</ng-template>

<ng-template #extendedKeyUsageEkstenzije let-modal>
    <div class="modal-header">
        <h4 class="modal-title" 
            id="modal-basic-title">
            Extended Key Usage
        </h4>
        <button type="button" class="close"
                aria-label="Close" (click)=
                "modal.dismiss('Cross click')">
  
            <span aria-hidden="true">
                ×
            </span>
        </button>
    </div>
        <div class="modal-body">
                <div class="form-group">
                    <div class="input-group">
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.daLiJeKriticno">Da li je kriticno</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.anyExtendedKeyUsage">Extended key usage</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_codeSigning">Code signing</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_emailProtection">Email protection</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_ipsecEndSystem">IP Security End System</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_ipsecUser">IP Security User</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_timeStamping">Time Stamping</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_OCSPSigning">OCSP Signing</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.extendedKeyUsageEkstenzije.id_kp_smartcardlogon">Smartcard logon</mat-checkbox>
                        </div>
                    </div>
                </div>
        </div>
        <div [ngClass]="['modal-footer','form-group']">
            
        </div>
</ng-template>

<ng-template #keyUsageEkstenzije let-modal>
    <div class="modal-header">
        <h4 class="modal-title" 
            id="modal-basic-title">
            Key Usage
        </h4>
        <button type="button" class="close"
                aria-label="Close" (click)=
                "modal.dismiss('Cross click')">
  
            <span aria-hidden="true">
                ×
            </span>
        </button>
    </div>
        <div class="modal-body">
                <div class="form-group">
                    <div class="input-group">
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.daLiKoristi">Da li je kriticno</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.digitalSignature">Digital Signature</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.nonRepudiation">Non Repudation</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.keyEncipherment">Key Encipherment</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.dataEncipherment">Data Encipherment</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.keyAgreement">Key Agreement</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.keyCertSign">Key Certificate Signing</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.da_li_jecrlsign">CRL Sign</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.encipherOnly">Encipher Only</mat-checkbox>
                        </div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.keyUsageEkstenzije.decipherOnly">Decipher Only</mat-checkbox>
                        </div>
                    </div>
                </div>
        </div>
        <div [ngClass]="['modal-footer','form-group']">
            
        </div>
</ng-template>

<ng-template #subjectAlternativeNameEkstenzije let-modal>
    <div class="modal-header">
        <h4 class="modal-title" 
            id="modal-basic-title">
            Subject Alternative Name
        </h4>
        <button type="button" class="close"
                aria-label="Close" (click)=
                "modal.dismiss('Cross click')">
  
            <span aria-hidden="true">
                ×
            </span>
        </button>
    </div>
        <div class="modal-body">
                <div class="form-group">
                    <div>
                        <div [ngClass]="['block']">
                            <mat-checkbox [(ngModel)]="ekstenzije.subjectAlternativeNameEkstenzije.daLiJeKriticno">Da li je kriticno</mat-checkbox>
                        </div>
                        
                        <div *ngFor="let name of ekstenzije.subjectAlternativeNameEkstenzije.alternativeNames" class="block">
                            <button type="button" class="button is-warning">
                                {{name.generalNameType}} : {{name.generalNameContent}}
                            </button>&nbsp;&nbsp;
                            <br>
                        </div>
                    </div>
                </div>
        </div>
        <div [ngClass]="['modal-footer','form-group']">
            
        </div>
</ng-template>